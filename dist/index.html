<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Razor Indent Formatter</title>
    <script type="module" crossorigin>
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const gt=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"]),nt=new Set(["script","style"]),mt=/<\s*\/\s*text\s*>/i,K="<!--",X="-->";function Lt(e,t){const n=vt(t.indentSize),{lines:i,lineEnding:o}=wt(e),s=i.map(a=>St(a,n)),r=new Array(i.length).fill(null),c=new Array(i.length).fill(!1),l=new Array(i.length).fill(0),p=new Array(i.length).fill(null),f=[],v=[];let w=0,O=!1,E=null,C=!1,d=null,S=!1,x=!1;const m=[];let B=null,R=!1;for(let a=0;a<i.length;a+=1){const L=i[a],g=s[a],h=g.rest.trimStart(),k=mt.test(h),j=S&&Q(L,(d==null?void 0:d.tagName)??"");if(C&&k&&(d&&(d.endLine=a-1,v.push(d),d=null),C=!1),S&&j&&(d&&(d.endLine=a-1,v.push(d),d=null),S=!1),C||S){r[a]=null;continue}const P=Ct(L,O);O=P.inComment;const b=P.cleaned;let T=Tt(h),I=0,W=0,y={open:0,close:0,inBlockComment:x};if(E)Q(b,E)&&(W+=1,T===0&&h.startsWith(`</${E}`)&&(T=1),E=null);else if(!O){if(tt(h)){const pt=Bt(b);for(const q of pt){if(q.isClosing){W+=1;continue}q.isSelfClosing||(I+=1,nt.has(q.name)&&(E=q.name))}}y=ot(g.rest,x),x=y.inBlockComment,I+=y.open,W+=y.close}const _=Math.max(0,w-T),N=tt(h),at=h.startsWith("@"),U=h.startsWith("@:"),ut=U?h.slice(2).trimStart():"",D=U?ut:at?"":h,ft=!N&&/^switch\s*\(/.test(D),G=!N&&(/^case\b/.test(D)||/^default\b/.test(D)),dt=!N&&D.startsWith("}"),Z=m.length>0&&w>=m[m.length-1],$=Math.max(0,w-W+I),ht=dt&&m.length>0&&$<m[m.length-1];let J=_*n;Z&&B!==null&&!G&&!ht&&(J+=n),r[a]=J;let Y=!1;for(ft&&(y.open>0?(m.push($),R=!1):(R=!0,Y=!0)),R&&y.open>0&&D.startsWith("{")&&(m.push($),R=!1),!Y&&R&&D.length>0&&!D.startsWith("{")&&(R=!1),Z&&G&&(B=w);m.length>0&&$<m[m.length-1];)m.pop();B!==null&&$<B&&(B=null),w=$,V(h,"text")&&!H(h,"text")&&(C=!0,d={startLine:a+1,endLine:a,parentLevel:Math.max(0,w-1),tagName:"text",skip:!1}),V(h,"script")&&!H(h,"script")&&(S=!0,d={startLine:a+1,endLine:a,parentLevel:Math.max(0,w-1),tagName:"script",skip:!1}),V(h,"style")&&!H(h,"style")&&(S=!0,d={startLine:a+1,endLine:a,parentLevel:Math.max(0,w-1),tagName:"style",skip:!1})}C&&d&&(d.endLine=i.length-1,d.skip=!0,v.push(d)),It(v,r,s,n,c,l,p);for(let a=0;a<r.length;a+=1)r[a]===null&&(r[a]=s[a].leadingWidth);const A=i.map((a,L)=>{var k;const g=r[L]??0;let h=s[L].rest;return(k=p[L])!=null&&k.isRawBlock&&!c[L]&&(h=kt(h)),c[L]?Et(h,g,l[L]??0):it(h,g)}),z=bt(A,p),M=z.lines.join(o),F=Rt(s,z.lines,z.insertedBlankLines);if(!F.ok)return{output:e,logs:[],error:F.message};f.push("Validation ok: non-leading content unchanged.");for(let a=0;a<s.length;a+=1){const L=s[a].leadingWidth,g=r[a]??L;L!==g&&f.push(`Line ${a+1}: ${L} -> ${g}`)}return f.length===0&&f.push("No indentation changes detected."),{output:M,logs:f}}function vt(e){return!Number.isFinite(e)||e<=0?2:Math.floor(e)}function wt(e){const t=e.includes(`\r
`)?`\r
`:`
`;return{lines:e.split(/\r\n|\n/),lineEnding:t}}function St(e,t){const n=e.match(/^(\s*)(.*)$/);if(!n)return{original:e,leading:"",rest:e,leadingWidth:0};const i=n[1],o=n[2];return{original:e,leading:i,rest:o,leadingWidth:xt(i,t)}}function xt(e,t){let n=0;for(const i of e)i==="	"?n+=t:n+=1;return n}function Ct(e,t){let n="",i=0;for(;i<e.length;){if(t){const s=e.indexOf(X,i);if(s===-1)return{cleaned:n,inComment:!0};i=s+X.length,t=!1;continue}const o=e.indexOf(K,i);if(o===-1){n+=e.slice(i);break}n+=e.slice(i,o),i=o+K.length,t=!0}return{cleaned:n,inComment:t}}function Bt(e){const t=[],n=/<[^>]+>/g;let i;for(;(i=n.exec(e))!==null;){const o=i[0];if(o.startsWith("<!")||o.startsWith("<?")||o.startsWith("<%"))continue;const s=o.match(/^<\s*\/?\s*([a-zA-Z0-9:-]+)/);if(!s)continue;const r=s[1].toLowerCase(),c=/^<\s*\//.test(o),l=/\/>\s*$/.test(o)||gt.has(r);t.push({name:r,isClosing:c,isSelfClosing:l})}return t}function Q(e,t){return t?new RegExp(`<\\s*\\/\\s*${t}\\s*>`,"i").test(e):!1}function Tt(e){let t=0,n=e;for(;;){const i=n.match(/^<\s*\/\s*[a-zA-Z0-9:-]+[^>]*>\s*/);if(i){t+=1,n=n.slice(i[0].length);continue}const o=n.match(/^@?\}\s*/);if(o){t+=1,n=n.slice(o[0].length);continue}break}return t}function tt(e){const t=e.toLowerCase();return t.startsWith("<")?!0:t.startsWith("@:")?t.slice(2).trimStart().startsWith("<"):!1}function V(e,t){const n=e.toLowerCase();return n.startsWith(`<${t}`)?!0:n.startsWith("@:")?n.slice(2).trimStart().startsWith(`<${t}`):!1}function H(e,t){const n=e.toLowerCase();return n.startsWith(`</${t}`)?!0:n.startsWith("@:")?n.slice(2).trimStart().startsWith(`</${t}`):!1}function It(e,t,n,i,o,s,r){for(const c of e){if(c.skip||c.endLine<c.startLine){yt(c,t,n);continue}const l=nt.has(c.tagName),p=c.parentLevel*i+(l&&c.parentLevel===0?0:i),f=[];let v=0,w=!1,O=0,E=!1,C=null,d=!1,S=null;for(let x=c.startLine;x<=c.endLine;x+=1){const m=n[x].rest;if(m.length===0){t[x]=0,S=null,l&&(r[x]={isRawBlock:!0,isCaseOrDefault:!1,isBreak:!1,isSwitchLine:!1});continue}const B=m.trimStart(),R=Wt(B),A=Math.max(0,v-(R>0?1:0)),z=B.startsWith("@"),M=B.startsWith("@:"),a=l&&(E||z&&!M),L=M?B.slice(2).trimStart():"",g=M?L:z?"":B,h=l&&/^switch\s*\(/.test(g),k=l&&(/^case\b/.test(g)||/^default\b/.test(g)),j=l&&/^break\b/.test(g),P=l&&g.startsWith("}"),b=l&&f.length>0&&v>=f[f.length-1],T=ot(m,w),I=Math.max(0,v+T.open-T.close),W=P&&f.length>0&&I<f[f.length-1];let y=p+A*i;if(b&&C!==null&&!k&&!W&&(y+=i),l&&M){S===null&&(S=A),y=p+S*i,o[x]=!0;let N=Math.max(0,(A-S)*i);b&&C!==null&&!k&&!W&&(N+=i),s[x]=N}else l&&(S=null);t[x]=y,l&&(r[x]={isRawBlock:!0,isCaseOrDefault:b&&k,isBreak:b&&j,isSwitchLine:b&&h}),w=T.inBlockComment,a&&(O=Math.max(0,O+T.open-T.close),E=O>0);let _=!1;for(l&&h&&(T.open>0?(f.push(I),d=!1):(d=!0,_=!0)),l&&d&&T.open>0&&g.startsWith("{")&&(f.push(I),d=!1),!_&&d&&g.length>0&&!g.startsWith("{")&&(d=!1),b&&k&&(C=v);f.length>0&&I<f[f.length-1];)f.pop();C!==null&&I<C&&(C=null),v=I}}}function yt(e,t,n){for(let i=e.startLine;i<=e.endLine;i+=1)t[i]=n[i].leadingWidth}function kt(e){const n=e.trimStart().match(/^switch\s*\((.*)\)\s*\{\s*$/);return n?"switch ("+n[1].trim()+") {":e}function bt(e,t){const n=[];let i=!1,o=!1,s=!1,r=!1;for(let c=0;c<e.length;c+=1){const l=t[c];if(!l||!l.isRawBlock){o=!1,s=!1,r=!1,n.push(e[c]);continue}if(o||(o=!0,s=!1,r=!1),l.isCaseOrDefault&&s&&!r){const v=e[c].match(/^(\s*)@:/);v?n.push(`${v[1]}@:`):n.push(""),i=!0}n.push(e[c]);const p=e[c].trim(),f=p.length===0||p==="@:";r=f,f||(s=l.isBreak)}return{lines:n,insertedBlankLines:i}}function Et(e,t,n){const i=e.match(/^@:([\s]*)(.*)$/);if(!i)return it(e,t);const o=i[2],s=t>0?" ".repeat(t):"";return o.length===0?`${s}@:`:`${s}@: ${" ".repeat(n)}${o.trimStart()}`}function it(e,t){return t<=0?e:`${" ".repeat(t)}${e}`}function Rt(e,t,n){const i=e.map(c=>c.original);if(!n&&i.length!==t.length)return{ok:!1,message:"Validation failed: line count changed."};const o=[];let s=0,r=0;for(;s<i.length&&r<t.length;){const c=t[r],l=c.trim();if(n&&(l.length===0||l==="@:")){const w=(i[s]??"").trim();(w.length===0||w==="@:")&&(s+=1),r+=1;continue}const p=et(i[s]),f=et(c);p!==f&&o.push(String(s+1)),s+=1,r+=1}if(s<i.length)for(let c=s;c<i.length;c+=1)o.push(String(c+1));if(n)for(let c=r;c<t.length;c+=1){const l=t[c].trim();if(l.length>0&&l!=="@:"){o.push(String(i.length));break}}else if(r<t.length)return{ok:!1,message:"Validation failed: line count changed."};return o.length>0?{ok:!1,message:`Validation failed: non-indentation content changed on line(s) ${o.join(", ")}.`}:{ok:!0,message:""}}function et(e){let t=e.replace(/^\s*/,"");return t.startsWith("@:")&&(t=t.replace(/^@:\s*/,"@:")),t=Ot(t),t}function Ot(e){const t=e.match(/^switch\s*\((.*)\)\s*\{\s*$/);return t?"switch ("+t[1].trim()+") {":e}function Wt(e){let t=e;const n=t.match(/^@:\s*/);n&&(t=t.slice(n[0].length));let i=0,o=0;for(;o<t.length;){if(t[o]==="}"){i+=1,o+=1;continue}break}return i}function ot(e,t){let n=0,i=0,o=!1,s=!1,r=!1,c=!1;for(let l=0;l<e.length;l+=1){const p=e[l],f=e[l+1]??"";if(t){p==="*"&&f==="/"&&(t=!1,l+=1);continue}if(!o&&!s&&!r){if(p==="/"&&f==="*"){t=!0,l+=1;continue}if(p==="/"&&f==="/")break}if(c){c=!1;continue}if(p==="\\\\"&&(o||s||r)){c=!0;continue}if(!s&&!r&&p==="'"){o=!o;continue}if(!o&&!r&&p==='"'){s=!s;continue}if(!o&&!s&&p==="`"){r=!r;continue}o||s||r||(p==="{"?n+=1:p==="}"&&(i+=1))}return{open:n,close:i,inBlockComment:t}}const st=4,rt=document.querySelector("#app");if(!rt)throw new Error("App root not found.");rt.innerHTML=`
  <div class="page">
    <header class="header">
      <div>
        <h1>Razor Indent Formatter</h1>
      </div>
      <div class="controls">
        <div class="control-group buttons">
          <button id="formatBtn" type="button" class="primary">Format</button>
          <button id="copyBtn" type="button">Copy Output</button>
          <button id="clearBtn" type="button">Clear</button>
          <button id="loadBtn" type="button">Load File</button>
          <input id="fileInput" type="file" hidden accept=".cshtml,.razor,.html,.cs,.js,.ts,.txt" />
        </div>
      </div>
    </header>

    <main class="grid">
      <section class="panel" id="inputPanel">
        <div class="panel-header">
          <h2>Input</h2>
          <span class="badge">Paste / Drop file</span>
        </div>
        <textarea id="input" spellcheck="false" wrap="off" placeholder="Paste Razor / HTML / JS here..."></textarea>
      </section>
      <section class="panel">
        <div class="panel-header">
          <h2>Output</h2>
          <span class="badge">Read-only</span>
        </div>
        <textarea id="output" spellcheck="false" wrap="off" readonly></textarea>
      </section>
    </main>

  </div>
`;const u=Dt();u.formatButton.addEventListener("click",()=>{zt(u)});u.copyButton.addEventListener("click",async()=>{const e=u.output.value;if(e)try{await navigator.clipboard.writeText(e),u.copyButton.textContent="Copied!",window.setTimeout(()=>{u.copyButton.textContent="Copy Output"},1200)}catch{u.copyButton.textContent="Copy failed",window.setTimeout(()=>{u.copyButton.textContent="Copy Output"},1200)}});u.clearButton.addEventListener("click",()=>{u.input.value="",u.output.value="",u.copyButton.textContent="Copy Output",u.input.focus()});u.loadButton.addEventListener("click",()=>{u.fileInput.click()});u.fileInput.addEventListener("change",async()=>{var t;const e=(t=u.fileInput.files)==null?void 0:t[0];e&&(await ct(e,u),u.fileInput.value="")});u.input.addEventListener("keydown",e=>{if(e.key!=="Tab")return;e.preventDefault();const t=u.input.selectionStart??0,n=u.input.selectionEnd??t,i=" ".repeat(st),o=u.input.value;u.input.value=o.slice(0,t)+i+o.slice(n);const s=t+i.length;u.input.selectionStart=s,u.input.selectionEnd=s});Nt(u);Mt(u.input,u.output);function Dt(){const e=document.querySelector("#input"),t=document.querySelector("#output"),n=document.querySelector("#inputPanel"),i=document.querySelector("#formatBtn"),o=document.querySelector("#copyBtn"),s=document.querySelector("#clearBtn"),r=document.querySelector("#loadBtn"),c=document.querySelector("#fileInput");if(!e||!t||!n||!i||!o||!s||!r||!c)throw new Error("UI elements not found.");return{input:e,output:t,inputPanel:n,formatButton:i,copyButton:o,clearButton:s,loadButton:r,fileInput:c}}function zt(e){const t=Lt(e.input.value,{indentSize:st});if(t.error){e.output.value=t.output;return}e.output.value=t.output}function Mt(e,t){let n=!1;const i=(o,s)=>{n||(n=!0,s.scrollTop=o.scrollTop,s.scrollLeft=o.scrollLeft,window.requestAnimationFrame(()=>{n=!1}))};e.addEventListener("scroll",()=>i(e,t),{passive:!0}),t.addEventListener("scroll",()=>i(t,e),{passive:!0})}function Nt(e){const{inputPanel:t}=e,n=i=>{i?t.classList.add("drag-over"):t.classList.remove("drag-over")};t.addEventListener("dragenter",i=>{i.preventDefault(),n(!0)}),t.addEventListener("dragover",i=>{i.preventDefault(),n(!0)}),t.addEventListener("dragleave",i=>{const o=i.relatedTarget;(!o||!(o instanceof Node)||!t.contains(o))&&n(!1)}),t.addEventListener("drop",async i=>{var s,r;i.preventDefault(),n(!1);const o=(r=(s=i.dataTransfer)==null?void 0:s.files)==null?void 0:r[0];o&&await ct(o,e)})}async function ct(e,t){const n=await e.arrayBuffer(),i=new Uint8Array(n),o=$t(i),s=o==="utf-8"?At(i):i,c=new TextDecoder(o).decode(s);t.input.value=c,t.output.value="",t.copyButton.textContent="Copy Output",t.input.focus()}function $t(e){if(lt(e)||Pt(e))return"utf-8";const t=["utf-8","shift_jis","euc-jp"];let n={encoding:"utf-8",score:Number.NEGATIVE_INFINITY,invalid:Number.POSITIVE_INFINITY};for(const i of t){const o=_t(e,i),s=Vt(e,i),r=Ht(s.text,s.hadReplacement);(o<n.invalid||o===n.invalid&&r>n.score)&&(n={encoding:i,score:r,invalid:o})}return n.encoding}function lt(e){return e.length>=3&&e[0]===239&&e[1]===187&&e[2]===191}function At(e){return lt(e)?e.subarray(3):e}function Pt(e){for(let t=0;t<e.length;t+=1)if(e[t]>=128)return!1;return!0}function _t(e,t){switch(t){case"utf-8":return qt(e);case"shift_jis":return Ft(e);case"euc-jp":return jt(e);default:return Number.POSITIVE_INFINITY}}function qt(e){let t=0;for(let n=0;n<e.length;n+=1){const i=e[n];if(!(i<=127)){if(i>=194&&i<=223){if((e[n+1]&192)!==128){t+=1;continue}n+=1;continue}if(i>=224&&i<=239){const o=e[n+1],s=e[n+2];if((o&192)!==128||(s&192)!==128){t+=1;continue}n+=2;continue}if(i>=240&&i<=244){const o=e[n+1],s=e[n+2],r=e[n+3];if((o&192)!==128||(s&192)!==128||(r&192)!==128){t+=1;continue}n+=3;continue}t+=1}}return t}function Ft(e){let t=0;for(let n=0;n<e.length;n+=1){const i=e[n];if(i<=127||i>=161&&i<=223)continue;if(!(i>=129&&i<=159||i>=224&&i<=252)){t+=1;continue}const s=e[n+1];if(s===void 0){t+=1;continue}if(!(s>=64&&s<=126||s>=128&&s<=252)||s===127){t+=1;continue}n+=1}return t}function jt(e){let t=0;for(let n=0;n<e.length;n+=1){const i=e[n];if(!(i<=127)){if(i===142){const o=e[n+1];if(o===void 0||o<161||o>223){t+=1;continue}n+=1;continue}if(i===143){const o=e[n+1],s=e[n+2];if(o===void 0||s===void 0||o<161||o>254||s<161||s>254){t+=1;continue}n+=2;continue}if(i>=161&&i<=254){const o=e[n+1];if(o===void 0||o<161||o>254){t+=1;continue}n+=1;continue}t+=1}}return t}function Vt(e,t){let n="",i=!1;if(t==="utf-8")try{return n=new TextDecoder("utf-8",{fatal:!0}).decode(e),{text:n,hadReplacement:!1}}catch{}return n=new TextDecoder(t).decode(e),i=n.includes("ï¿½"),{text:n,hadReplacement:i}}function Ht(e,t){let n=0,i=0;for(let s=0;s<e.length;s+=1){const r=e.charCodeAt(s);if(r!==65533){if(r<32&&r!==9&&r!==10&&r!==13){i+=1;continue}(r>=12352&&r<=12447||r>=12448&&r<=12543||r>=19968&&r<=40959||r>=65381&&r<=65439)&&(n+=1)}}let o=n*2-i*2;return t&&(o-=5),o}

</script>
    <style>
:root{--bg: radial-gradient(circle at top left, #f5f1e8, #efe6d6 40%, #e7dfd0 100%);--panel: #f9f6ef;--ink: #1f1c17;--muted: #6f655a;--accent: #c0663f;--accent-dark: #8d4b32;--border: #d9cfbf;--shadow: 0 18px 40px rgba(40, 28, 16, .12);--radius: 18px;--mono: "Courier New", Courier, monospace;--sans: "Trebuchet MS", "Segoe UI", sans-serif;--serif: "Palatino Linotype", "Book Antiqua", Palatino, serif}*{box-sizing:border-box}body{margin:0;min-height:100vh;background:var(--bg);color:var(--ink);font-family:var(--sans)}#app{padding:24px 12px 20px;min-height:100vh}.page{max-width:1920px;width:100%;margin:0 auto;display:flex;flex-direction:column;gap:24px;min-height:calc(100vh - 52px);animation:fadeIn .6s ease-out}.header{display:flex;flex-wrap:wrap;align-items:flex-start;gap:20px 32px;justify-content:space-between}.header h1{font-family:var(--serif);font-size:2.4rem;margin:0 0 8px}.header p{margin:0;color:var(--muted)}.controls{display:flex;flex-wrap:wrap;gap:12px 16px;align-items:center;justify-content:flex-end}.control-group{display:flex;flex-direction:column;gap:6px;font-size:.85rem;color:var(--muted)}.control-group.buttons{flex-direction:row;gap:12px}button{border:1px solid var(--border);border-radius:12px;padding:12px 20px;font-family:var(--sans);font-weight:600;background:#fff;color:var(--ink);cursor:pointer;transition:transform .2s ease,box-shadow .2s ease;min-width:140px}button:hover{transform:translateY(-1px);box-shadow:0 8px 18px #00000014}button.primary{background:linear-gradient(135deg,var(--accent),var(--accent-dark));border-color:transparent;color:#fff}.grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:20px;flex:1;min-height:0}.panel{background:var(--panel);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:12px;min-height:0}.panel.drag-over{outline:2px dashed var(--accent);outline-offset:4px;box-shadow:0 0 0 3px #c0663f2e,var(--shadow)}.panel-header{display:flex;align-items:center;justify-content:space-between;gap:12px}.panel-header h2{margin:0;font-size:1.2rem}.badge{background:#c0663f1f;color:var(--accent-dark);padding:4px 10px;border-radius:999px;font-size:.75rem;font-weight:600}textarea{flex:1;width:100%;resize:vertical;min-height:0;border-radius:14px;border:1px solid var(--border);padding:14px;font-size:.9rem;font-family:var(--mono);background:#fff;color:var(--ink);line-height:1.5;white-space:pre;overflow-wrap:normal;overflow:auto}textarea[readonly]{background:#faf7f1}@keyframes fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@media (max-width: 720px){.header{flex-direction:column;align-items:flex-start}.controls{width:100%;justify-content:flex-start}.grid{grid-template-columns:1fr;flex:1}}

</style>
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
