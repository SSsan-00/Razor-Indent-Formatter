<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Razor Indent Formatter</title>
    <script type="module" crossorigin>
(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=e(o);fetch(o.href,i)}})();const F=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"]),V=new Set(["script","style"]),D=/<\s*\/\s*text\s*>/i,R="<!--",$="-->";function j(t,n){const e=G(n.indentSize),{lines:s,lineEnding:o}=Z(t),i=s.map(r=>J(r,e)),a=new Array(s.length).fill(null),f=[],u=[];let c=0,h=!1,m=null,L=!1,l=null,w=!1,O=!1;for(let r=0;r<s.length;r+=1){const g=s[r],y=i[r],d=y.rest.trimStart(),P=D.test(d),_=w&&I(g,(l==null?void 0:l.tagName)??"");if(L&&P&&(l&&(l.endLine=r-1,u.push(l),l=null),L=!1),w&&_&&(l&&(l.endLine=r-1,u.push(l),l=null),w=!1),L||w){a[r]=null;continue}const W=U(g,h);h=W.inComment;const E=W.cleaned;let v=Q(d),b=0,x=0;if(m)I(E,m)&&(x+=1,v===0&&d.startsWith(`</${m}`)&&(v=1),m=null);else if(!h){if(Y(d)){const H=X(E);for(const C of H){if(C.isClosing){x+=1;continue}C.isSelfClosing||(b+=1,V.has(C.name)&&(m=C.name))}}const S=A(y.rest,O);O=S.inBlockComment,b+=S.open,x+=S.close}const q=Math.max(0,c-v);a[r]=q*e,c=Math.max(0,c-x+b),T(d,"text")&&!k(d,"text")&&(L=!0,l={startLine:r+1,endLine:r,parentLevel:Math.max(0,c-1),tagName:"text",skip:!1}),T(d,"script")&&!k(d,"script")&&(w=!0,l={startLine:r+1,endLine:r,parentLevel:Math.max(0,c-1),tagName:"script",skip:!1}),T(d,"style")&&!k(d,"style")&&(w=!0,l={startLine:r+1,endLine:r,parentLevel:Math.max(0,c-1),tagName:"style",skip:!1})}L&&l&&(l.endLine=s.length-1,l.skip=!0,u.push(l)),tt(u,a,i,e);for(let r=0;r<a.length;r+=1)a[r]===null&&(a[r]=i[r].leadingWidth);const M=s.map((r,g)=>{const y=a[g]??0;return nt(i[g].rest,y)}),N=M.join(o),B=st(i,M);if(!B.ok)return{output:t,logs:[],error:B.message};f.push("Validation ok: non-leading content unchanged.");for(let r=0;r<i.length;r+=1){const g=i[r].leadingWidth,y=a[r]??g;g!==y&&f.push(`Line ${r+1}: ${g} -> ${y}`)}return f.length===0&&f.push("No indentation changes detected."),{output:N,logs:f}}function G(t){return!Number.isFinite(t)||t<=0?2:Math.floor(t)}function Z(t){const n=t.includes(`\r
`)?`\r
`:`
`;return{lines:t.split(/\r\n|\n/),lineEnding:n}}function J(t,n){const e=t.match(/^(\s*)(.*)$/);if(!e)return{original:t,leading:"",rest:t,leadingWidth:0};const s=e[1],o=e[2];return{original:t,leading:s,rest:o,leadingWidth:K(s,n)}}function K(t,n){let e=0;for(const s of t)s==="	"?e+=n:e+=1;return e}function U(t,n){let e="",s=0;for(;s<t.length;){if(n){const i=t.indexOf($,s);if(i===-1)return{cleaned:e,inComment:!0};s=i+$.length,n=!1;continue}const o=t.indexOf(R,s);if(o===-1){e+=t.slice(s);break}e+=t.slice(s,o),s=o+R.length,n=!0}return{cleaned:e,inComment:n}}function X(t){const n=[],e=/<[^>]+>/g;let s;for(;(s=e.exec(t))!==null;){const o=s[0];if(o.startsWith("<!")||o.startsWith("<?")||o.startsWith("<%"))continue;const i=o.match(/^<\s*\/?\s*([a-zA-Z0-9:-]+)/);if(!i)continue;const a=i[1].toLowerCase(),f=/^<\s*\//.test(o),u=/\/>\s*$/.test(o)||F.has(a);n.push({name:a,isClosing:f,isSelfClosing:u})}return n}function I(t,n){return n?new RegExp(`<\\s*\\/\\s*${n}\\s*>`,"i").test(t):!1}function Q(t){let n=0,e=t;for(;;){const s=e.match(/^<\s*\/\s*[a-zA-Z0-9:-]+[^>]*>\s*/);if(s){n+=1,e=e.slice(s[0].length);continue}const o=e.match(/^@?\}\s*/);if(o){n+=1,e=e.slice(o[0].length);continue}break}return n}function Y(t){const n=t.toLowerCase();return n.startsWith("<")?!0:n.startsWith("@:")?n.slice(2).trimStart().startsWith("<"):!1}function T(t,n){const e=t.toLowerCase();return e.startsWith(`<${n}`)?!0:e.startsWith("@:")?e.slice(2).trimStart().startsWith(`<${n}`):!1}function k(t,n){const e=t.toLowerCase();return e.startsWith(`</${n}`)?!0:e.startsWith("@:")?e.slice(2).trimStart().startsWith(`</${n}`):!1}function tt(t,n,e,s){for(const o of t){if(o.skip||o.endLine<o.startLine){et(o,n,e);continue}const i=o.parentLevel*s+s;let a=0,f=!1;for(let u=o.startLine;u<=o.endLine;u+=1){const c=e[u].rest,h=c.trimStart(),m=ot(h),L=Math.max(0,a-(m>0?1:0));n[u]=i+L*s;const l=A(c,f);f=l.inBlockComment,a=Math.max(0,a+l.open-l.close)}}}function et(t,n,e){for(let s=t.startLine;s<=t.endLine;s+=1)n[s]=e[s].leadingWidth}function nt(t,n){return n<=0?t:`${" ".repeat(n)}${t}`}function st(t,n){if(t.length!==n.length)return{ok:!1,message:"Validation failed: line count changed."};const e=[];for(let s=0;s<t.length;s+=1){const o=t[s].original.replace(/^\s*/,""),i=n[s].replace(/^\s*/,"");o!==i&&e.push(String(s+1))}return e.length>0?{ok:!1,message:`Validation failed: non-indentation content changed on line(s) ${e.join(", ")}.`}:{ok:!0,message:""}}function ot(t){let n=0,e=0;for(;e<t.length;){if(t[e]==="}"){n+=1,e+=1;continue}break}return n}function A(t,n){let e=0,s=0,o=!1,i=!1,a=!1,f=!1;for(let u=0;u<t.length;u+=1){const c=t[u],h=t[u+1]??"";if(n){c==="*"&&h==="/"&&(n=!1,u+=1);continue}if(!o&&!i&&!a){if(c==="/"&&h==="*"){n=!0,u+=1;continue}if(c==="/"&&h==="/")break}if(f){f=!1;continue}if(c==="\\\\"&&(o||i||a)){f=!0;continue}if(!i&&!a&&c==="'"){o=!o;continue}if(!o&&!a&&c==='"'){i=!i;continue}if(!o&&!i&&c==="`"){a=!a;continue}o||i||a||(c==="{"?e+=1:c==="}"&&(s+=1))}return{open:e,close:s,inBlockComment:n}}const z=document.querySelector("#app");if(!z)throw new Error("App root not found.");z.innerHTML=`
  <div class="page">
    <header class="header">
      <div>
        <h1>Razor Indent Formatter</h1>
      </div>
      <div class="controls">
        <div class="control-group buttons">
          <button id="formatBtn" type="button" class="primary">Format</button>
          <button id="copyBtn" type="button">Copy Output</button>
        </div>
      </div>
    </header>

    <main class="grid">
      <section class="panel">
        <div class="panel-header">
          <h2>Input</h2>
          <span class="badge">Paste here</span>
        </div>
        <textarea id="input" spellcheck="false" wrap="off" placeholder="Paste Razor / HTML / JS here..."></textarea>
      </section>
      <section class="panel">
        <div class="panel-header">
          <h2>Output</h2>
          <span class="badge">Read-only</span>
        </div>
        <textarea id="output" spellcheck="false" wrap="off" readonly></textarea>
      </section>
    </main>

  </div>
`;const p=it();p.formatButton.addEventListener("click",()=>{rt(p)});p.copyButton.addEventListener("click",async()=>{const t=p.output.value;if(t)try{await navigator.clipboard.writeText(t),p.copyButton.textContent="Copied!",window.setTimeout(()=>{p.copyButton.textContent="Copy Output"},1200)}catch{p.copyButton.textContent="Copy failed",window.setTimeout(()=>{p.copyButton.textContent="Copy Output"},1200)}});at(p.input,p.output);function it(){const t=document.querySelector("#input"),n=document.querySelector("#output"),e=document.querySelector("#formatBtn"),s=document.querySelector("#copyBtn");if(!t||!n||!e||!s)throw new Error("UI elements not found.");return{input:t,output:n,formatButton:e,copyButton:s}}function rt(t){const e=j(t.input.value,{indentSize:4});e.error||(t.output.value=e.output)}function at(t,n){let e=!1;const s=(o,i)=>{e||(e=!0,i.scrollTop=o.scrollTop,i.scrollLeft=o.scrollLeft,window.requestAnimationFrame(()=>{e=!1}))};t.addEventListener("scroll",()=>s(t,n),{passive:!0}),n.addEventListener("scroll",()=>s(n,t),{passive:!0})}

</script>
    <style>
:root{--bg: radial-gradient(circle at top left, #f5f1e8, #efe6d6 40%, #e7dfd0 100%);--panel: #f9f6ef;--ink: #1f1c17;--muted: #6f655a;--accent: #c0663f;--accent-dark: #8d4b32;--border: #d9cfbf;--shadow: 0 18px 40px rgba(40, 28, 16, .12);--radius: 18px;--mono: "Courier New", Courier, monospace;--sans: "Trebuchet MS", "Segoe UI", sans-serif;--serif: "Palatino Linotype", "Book Antiqua", Palatino, serif}*{box-sizing:border-box}body{margin:0;min-height:100vh;background:var(--bg);color:var(--ink);font-family:var(--sans)}#app{padding:24px 12px 20px;min-height:100vh}.page{max-width:1920px;width:100%;margin:0 auto;display:flex;flex-direction:column;gap:24px;min-height:calc(100vh - 52px);animation:fadeIn .6s ease-out}.header{display:flex;flex-wrap:wrap;align-items:flex-start;gap:20px 32px;justify-content:space-between}.header h1{font-family:var(--serif);font-size:2.4rem;margin:0 0 8px}.header p{margin:0;color:var(--muted)}.controls{display:flex;flex-wrap:wrap;gap:12px 16px;align-items:center;justify-content:flex-end}.control-group{display:flex;flex-direction:column;gap:6px;font-size:.85rem;color:var(--muted)}.control-group.buttons{flex-direction:row;gap:12px}button{border:1px solid var(--border);border-radius:12px;padding:12px 20px;font-family:var(--sans);font-weight:600;background:#fff;color:var(--ink);cursor:pointer;transition:transform .2s ease,box-shadow .2s ease;min-width:140px}button:hover{transform:translateY(-1px);box-shadow:0 8px 18px #00000014}button.primary{background:linear-gradient(135deg,var(--accent),var(--accent-dark));border-color:transparent;color:#fff}.grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:20px;flex:1;min-height:0}.panel{background:var(--panel);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:12px;min-height:0}.panel-header{display:flex;align-items:center;justify-content:space-between;gap:12px}.panel-header h2{margin:0;font-size:1.2rem}.badge{background:#c0663f1f;color:var(--accent-dark);padding:4px 10px;border-radius:999px;font-size:.75rem;font-weight:600}textarea{flex:1;width:100%;resize:vertical;min-height:0;border-radius:14px;border:1px solid var(--border);padding:14px;font-size:.9rem;font-family:var(--mono);background:#fff;color:var(--ink);line-height:1.5;white-space:pre;overflow-wrap:normal;overflow:auto}textarea[readonly]{background:#faf7f1}@keyframes fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@media (max-width: 720px){.header{flex-direction:column;align-items:flex-start}.controls{width:100%;justify-content:flex-start}.grid{grid-template-columns:1fr;flex:1}}

</style>
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
