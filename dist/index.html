<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Razor Indent Formatter</title>
    <script type="module" crossorigin>
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();const gt=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"]),nt=new Set(["script","style"]),mt=/<\s*\/\s*text\s*>/i,X="<!--",Y="-->";function Lt(e,t){const i=wt(t.indentSize),{lines:n,lineEnding:s}=vt(e),o=n.map(c=>yt(c,i)),r=new Array(n.length).fill(null),l=new Array(n.length).fill(!1),a=new Array(n.length).fill(0),p=new Array(n.length).fill(null),f=[],w=[];let v=0,O=!1,R=null,C=!1,d=null,y=!1,x=!1;const m=[];let S=null,E=!1;for(let c=0;c<n.length;c+=1){const L=n[c],g=o[c],h=g.rest.trimStart(),b=mt.test(h),j=y&&Q(L,(d==null?void 0:d.tagName)??"");if(C&&b&&(d&&(d.endLine=c-1,w.push(d),d=null),C=!1),y&&j&&(d&&(d.endLine=c-1,w.push(d),d=null),y=!1),C||y){r[c]=null;continue}const P=Ct(L,O);O=P.inComment;const I=P.cleaned;let B=Bt(h),T=0,W=0,k={open:0,close:0,inBlockComment:x};if(R)Q(I,R)&&(W+=1,B===0&&h.startsWith(`</${R}`)&&(B=1),R=null);else if(!O){if(tt(h)){const pt=St(I);for(const _ of pt){if(_.isClosing){W+=1;continue}_.isSelfClosing||(T+=1,nt.has(_.name)&&(R=_.name))}}k=st(g.rest,x),x=k.inBlockComment,T+=k.open,W+=k.close}const q=Math.max(0,v-B),$=tt(h),ct=h.startsWith("@"),G=h.startsWith("@:"),ut=G?h.slice(2).trimStart():"",D=G?ut:ct?"":h,ft=!$&&/^switch\s*\(/.test(D),U=!$&&(/^case\b/.test(D)||/^default\b/.test(D)),dt=!$&&D.startsWith("}"),Z=m.length>0&&v>=m[m.length-1],A=Math.max(0,v-W+T),ht=dt&&m.length>0&&A<m[m.length-1];let J=q*i;Z&&S!==null&&!U&&!ht&&(J+=i),r[c]=J;let K=!1;for(ft&&(k.open>0?(m.push(A),E=!1):(E=!0,K=!0)),E&&k.open>0&&D.startsWith("{")&&(m.push(A),E=!1),!K&&E&&D.length>0&&!D.startsWith("{")&&(E=!1),Z&&U&&(S=v);m.length>0&&A<m[m.length-1];)m.pop();S!==null&&A<S&&(S=null),v=A,H(h,"text")&&!V(h,"text")&&(C=!0,d={startLine:c+1,endLine:c,parentLevel:Math.max(0,v-1),tagName:"text",skip:!1}),H(h,"script")&&!V(h,"script")&&(y=!0,d={startLine:c+1,endLine:c,parentLevel:Math.max(0,v-1),tagName:"script",skip:!1}),H(h,"style")&&!V(h,"style")&&(y=!0,d={startLine:c+1,endLine:c,parentLevel:Math.max(0,v-1),tagName:"style",skip:!1})}C&&d&&(d.endLine=n.length-1,d.skip=!0,w.push(d)),Tt(w,r,o,i,l,a,p);for(let c=0;c<r.length;c+=1)r[c]===null&&(r[c]=o[c].leadingWidth);const N=n.map((c,L)=>{var b;const g=r[L]??0;let h=o[L].rest;return(b=p[L])!=null&&b.isRawBlock&&!l[L]&&(h=bt(h)),l[L]?Rt(h,g,a[L]??0):it(h,g)}),z=It(N,p),M=z.lines.join(s),F=Et(o,z.lines,z.insertedBlankLines);if(!F.ok)return{output:e,logs:[],error:F.message};f.push("Validation ok: non-leading content unchanged.");for(let c=0;c<o.length;c+=1){const L=o[c].leadingWidth,g=r[c]??L;L!==g&&f.push(`Line ${c+1}: ${L} -> ${g}`)}return f.length===0&&f.push("No indentation changes detected."),{output:M,logs:f}}function wt(e){return!Number.isFinite(e)||e<=0?2:Math.floor(e)}function vt(e){const t=e.includes(`\r
`)?`\r
`:`
`;return{lines:e.split(/\r\n|\n/),lineEnding:t}}function yt(e,t){const i=e.match(/^(\s*)(.*)$/);if(!i)return{original:e,leading:"",rest:e,leadingWidth:0};const n=i[1],s=i[2];return{original:e,leading:n,rest:s,leadingWidth:xt(n,t)}}function xt(e,t){let i=0;for(const n of e)n==="	"?i+=t:i+=1;return i}function Ct(e,t){let i="",n=0;for(;n<e.length;){if(t){const o=e.indexOf(Y,n);if(o===-1)return{cleaned:i,inComment:!0};n=o+Y.length,t=!1;continue}const s=e.indexOf(X,n);if(s===-1){i+=e.slice(n);break}i+=e.slice(n,s),n=s+X.length,t=!0}return{cleaned:i,inComment:t}}function St(e){const t=[],i=/<[^>]+>/g;let n;for(;(n=i.exec(e))!==null;){const s=n[0];if(s.startsWith("<!")||s.startsWith("<?")||s.startsWith("<%"))continue;const o=s.match(/^<\s*\/?\s*([a-zA-Z0-9:-]+)/);if(!o)continue;const r=o[1].toLowerCase(),l=/^<\s*\//.test(s),a=/\/>\s*$/.test(s)||gt.has(r);t.push({name:r,isClosing:l,isSelfClosing:a})}return t}function Q(e,t){return t?new RegExp(`<\\s*\\/\\s*${t}\\s*>`,"i").test(e):!1}function Bt(e){let t=0,i=e;for(;;){const n=i.match(/^<\s*\/\s*[a-zA-Z0-9:-]+[^>]*>\s*/);if(n){t+=1,i=i.slice(n[0].length);continue}const s=i.match(/^@?\}\s*/);if(s){t+=1,i=i.slice(s[0].length);continue}break}return t}function tt(e){const t=e.toLowerCase();return t.startsWith("<")?!0:t.startsWith("@:")?t.slice(2).trimStart().startsWith("<"):!1}function H(e,t){const i=e.toLowerCase();return i.startsWith(`<${t}`)?!0:i.startsWith("@:")?i.slice(2).trimStart().startsWith(`<${t}`):!1}function V(e,t){const i=e.toLowerCase();return i.startsWith(`</${t}`)?!0:i.startsWith("@:")?i.slice(2).trimStart().startsWith(`</${t}`):!1}function Tt(e,t,i,n,s,o,r){for(const l of e){if(l.skip||l.endLine<l.startLine){kt(l,t,i);continue}const a=nt.has(l.tagName),p=l.parentLevel*n+(a&&l.parentLevel===0?0:n),f=[];let w=0,v=!1,O=0,R=!1,C=null,d=!1,y=null;for(let x=l.startLine;x<=l.endLine;x+=1){const m=i[x].rest;if(m.length===0){t[x]=0,y=null,a&&(r[x]={isRawBlock:!0,isCaseOrDefault:!1,isBreak:!1,isSwitchLine:!1});continue}const S=m.trimStart(),E=Wt(S),N=Math.max(0,w-(E>0?1:0)),z=S.startsWith("@"),M=S.startsWith("@:"),c=a&&(R||z&&!M),L=M?S.slice(2).trimStart():"",g=M?L:z?"":S,h=a&&/^switch\s*\(/.test(g),b=a&&(/^case\b/.test(g)||/^default\b/.test(g)),j=a&&/^break\b/.test(g),P=a&&g.startsWith("}"),I=a&&f.length>0&&w>=f[f.length-1],B=st(m,v),T=Math.max(0,w+B.open-B.close),W=P&&f.length>0&&T<f[f.length-1];let k=p+N*n;if(I&&C!==null&&!b&&!W&&(k+=n),a&&M){y===null&&(y=N),k=p+y*n,s[x]=!0;let $=Math.max(0,(N-y)*n);I&&C!==null&&!b&&!W&&($+=n),o[x]=$}else a&&(y=null);t[x]=k,a&&(r[x]={isRawBlock:!0,isCaseOrDefault:I&&b,isBreak:I&&j,isSwitchLine:I&&h}),v=B.inBlockComment,c&&(O=Math.max(0,O+B.open-B.close),R=O>0);let q=!1;for(a&&h&&(B.open>0?(f.push(T),d=!1):(d=!0,q=!0)),a&&d&&B.open>0&&g.startsWith("{")&&(f.push(T),d=!1),!q&&d&&g.length>0&&!g.startsWith("{")&&(d=!1),I&&b&&(C=w);f.length>0&&T<f[f.length-1];)f.pop();C!==null&&T<C&&(C=null),w=T}}}function kt(e,t,i){for(let n=e.startLine;n<=e.endLine;n+=1)t[n]=i[n].leadingWidth}function bt(e){const i=e.trimStart().match(/^switch\s*\((.*)\)\s*\{\s*$/);return i?"switch ("+i[1].trim()+") {":e}function It(e,t){const i=[];let n=!1,s=!1,o=!1,r=!1;for(let l=0;l<e.length;l+=1){const a=t[l];if(!a||!a.isRawBlock){s=!1,o=!1,r=!1,i.push(e[l]);continue}if(s||(s=!0,o=!1,r=!1),a.isCaseOrDefault&&o&&!r){const w=e[l].match(/^(\s*)@:/);w?i.push(`${w[1]}@:`):i.push(""),n=!0}i.push(e[l]);const p=e[l].trim(),f=p.length===0||p==="@:";r=f,f||(o=a.isBreak)}return{lines:i,insertedBlankLines:n}}function Rt(e,t,i){const n=e.match(/^@:([\s]*)(.*)$/);if(!n)return it(e,t);const s=n[2],o=t>0?" ".repeat(t):"";return s.length===0?`${o}@:`:`${o}@: ${" ".repeat(i)}${s.trimStart()}`}function it(e,t){return t<=0?e:`${" ".repeat(t)}${e}`}function Et(e,t,i){const n=e.map(l=>l.original);if(!i&&n.length!==t.length)return{ok:!1,message:"Validation failed: line count changed."};const s=[];let o=0,r=0;for(;o<n.length&&r<t.length;){const l=t[r],a=l.trim();if(i&&(a.length===0||a==="@:")){const v=(n[o]??"").trim();(v.length===0||v==="@:")&&(o+=1),r+=1;continue}const p=et(n[o]),f=et(l);p!==f&&s.push(String(o+1)),o+=1,r+=1}if(o<n.length)for(let l=o;l<n.length;l+=1)s.push(String(l+1));if(i)for(let l=r;l<t.length;l+=1){const a=t[l].trim();if(a.length>0&&a!=="@:"){s.push(String(n.length));break}}else if(r<t.length)return{ok:!1,message:"Validation failed: line count changed."};return s.length>0?{ok:!1,message:`Validation failed: non-indentation content changed on line(s) ${s.join(", ")}.`}:{ok:!0,message:""}}function et(e){let t=e.replace(/^\s*/,"");return t.startsWith("@:")&&(t=t.replace(/^@:\s*/,"@:")),t=Ot(t),t}function Ot(e){const t=e.match(/^switch\s*\((.*)\)\s*\{\s*$/);return t?"switch ("+t[1].trim()+") {":e}function Wt(e){let t=e;const i=t.match(/^@:\s*/);i&&(t=t.slice(i[0].length));let n=0,s=0;for(;s<t.length;){if(t[s]==="}"){n+=1,s+=1;continue}break}return n}function st(e,t){let i=0,n=0,s=!1,o=!1,r=!1,l=!1;for(let a=0;a<e.length;a+=1){const p=e[a],f=e[a+1]??"";if(t){p==="*"&&f==="/"&&(t=!1,a+=1);continue}if(!s&&!o&&!r){if(p==="/"&&f==="*"){t=!0,a+=1;continue}if(p==="/"&&f==="/")break}if(l){l=!1;continue}if(p==="\\\\"&&(s||o||r)){l=!0;continue}if(!o&&!r&&p==="'"){s=!s;continue}if(!s&&!r&&p==='"'){o=!o;continue}if(!s&&!o&&p==="`"){r=!r;continue}s||o||r||(p==="{"?i+=1:p==="}"&&(n+=1))}return{open:i,close:n,inBlockComment:t}}const ot=4,rt=document.querySelector("#app");if(!rt)throw new Error("App root not found.");rt.innerHTML=`
  <div class="page">
    <header class="header">
      <div>
        <h1>Razor Indent Formatter</h1>
      </div>
      <div class="controls">
        <div class="control-group buttons">
          <button id="formatBtn" type="button" class="primary">Format</button>
          <button id="copyBtn" type="button">Copy Output</button>
          <button id="clearBtn" type="button">Clear</button>
          <button id="loadBtn" type="button">Load File</button>
          <input id="fileInput" type="file" hidden accept=".cshtml,.razor,.html,.cs,.js,.ts,.txt" />
        </div>
      </div>
    </header>

    <main class="grid">
      <section class="panel" id="inputPanel">
        <div class="panel-header">
          <h2>Input</h2>
          <span class="badge">Paste / Drop file</span>
        </div>
        <textarea id="input" spellcheck="false" wrap="off" placeholder="Paste Razor / HTML / JS here..."></textarea>
      </section>
      <section class="panel">
        <div class="panel-header">
          <h2>Output</h2>
          <span class="badge">Read-only</span>
        </div>
        <textarea id="output" spellcheck="false" wrap="off" readonly></textarea>
      </section>
    </main>

  </div>
`;const u=Dt();u.formatButton.addEventListener("click",()=>{zt(u)});u.copyButton.addEventListener("click",async()=>{const e=u.output.value;if(e)try{await navigator.clipboard.writeText(e),u.copyButton.textContent="Copied!",window.setTimeout(()=>{u.copyButton.textContent="Copy Output"},1200)}catch{u.copyButton.textContent="Copy failed",window.setTimeout(()=>{u.copyButton.textContent="Copy Output"},1200)}});u.clearButton.addEventListener("click",()=>{u.input.value="",u.output.value="",u.copyButton.textContent="Copy Output",u.input.focus()});u.loadButton.addEventListener("click",()=>{u.fileInput.click()});u.fileInput.addEventListener("change",async()=>{var t;const e=(t=u.fileInput.files)==null?void 0:t[0];e&&(await lt(e,u),u.fileInput.value="")});u.input.addEventListener("keydown",e=>{if(e.key!=="Tab")return;e.preventDefault();const t=u.input.selectionStart??0,i=u.input.selectionEnd??t,n=" ".repeat(ot),s=u.input.value;u.input.value=s.slice(0,t)+n+s.slice(i);const o=t+n.length;u.input.selectionStart=o,u.input.selectionEnd=o});$t(u);Mt(u.input,u.output);function Dt(){const e=document.querySelector("#input"),t=document.querySelector("#output"),i=document.querySelector("#inputPanel"),n=document.querySelector("#formatBtn"),s=document.querySelector("#copyBtn"),o=document.querySelector("#clearBtn"),r=document.querySelector("#loadBtn"),l=document.querySelector("#fileInput");if(!e||!t||!i||!n||!s||!o||!r||!l)throw new Error("UI elements not found.");return{input:e,output:t,inputPanel:i,formatButton:n,copyButton:s,clearButton:o,loadButton:r,fileInput:l}}function zt(e){const t=Lt(e.input.value,{indentSize:ot});if(t.error){e.output.value=t.output;return}e.output.value=t.output}function Mt(e,t){let i=!1;const n=(s,o)=>{i||(i=!0,o.scrollTop=s.scrollTop,o.scrollLeft=s.scrollLeft,window.requestAnimationFrame(()=>{i=!1}))};e.addEventListener("scroll",()=>n(e,t),{passive:!0}),t.addEventListener("scroll",()=>n(t,e),{passive:!0})}function $t(e){const{inputPanel:t}=e,i=n=>{n?t.classList.add("drag-over"):t.classList.remove("drag-over")};t.addEventListener("dragenter",n=>{n.preventDefault(),i(!0)}),t.addEventListener("dragover",n=>{n.preventDefault(),i(!0)}),t.addEventListener("dragleave",n=>{const s=n.relatedTarget;(!s||!(s instanceof Node)||!t.contains(s))&&i(!1)}),t.addEventListener("drop",async n=>{var o,r;n.preventDefault(),i(!1);const s=(r=(o=n.dataTransfer)==null?void 0:o.files)==null?void 0:r[0];s&&await lt(s,e)})}async function lt(e,t){const i=await e.arrayBuffer(),n=new Uint8Array(i),s=At(n),o=s==="utf-8"?Nt(n):n,l=new TextDecoder(s).decode(o);t.input.value=l,t.output.value="",t.copyButton.textContent="Copy Output",t.input.focus()}function At(e){if(at(e))return"utf-8";const t=["utf-8","shift_jis","euc-jp"];let i={encoding:"utf-8",score:Number.NEGATIVE_INFINITY};for(const n of t){const s=Pt(e,n),o=qt(s.text,s.hadReplacement);o>i.score&&(i={encoding:n,score:o})}return i.encoding}function at(e){return e.length>=3&&e[0]===239&&e[1]===187&&e[2]===191}function Nt(e){return at(e)?e.subarray(3):e}function Pt(e,t){let i="",n=!1;if(t==="utf-8")try{return i=new TextDecoder("utf-8",{fatal:!0}).decode(e),{text:i,hadReplacement:!1}}catch{}return i=new TextDecoder(t).decode(e),n=i.includes("ï¿½"),{text:i,hadReplacement:n}}function qt(e,t){let i=0,n=0;for(let o=0;o<e.length;o+=1){const r=e.charCodeAt(o);if(r!==65533){if(r<32&&r!==9&&r!==10&&r!==13){n+=1;continue}(r>=12352&&r<=12447||r>=12448&&r<=12543||r>=19968&&r<=40959||r>=65381&&r<=65439)&&(i+=1)}}let s=i*2-n*2;return t&&(s-=5),s}

</script>
    <style>
:root{--bg: radial-gradient(circle at top left, #f5f1e8, #efe6d6 40%, #e7dfd0 100%);--panel: #f9f6ef;--ink: #1f1c17;--muted: #6f655a;--accent: #c0663f;--accent-dark: #8d4b32;--border: #d9cfbf;--shadow: 0 18px 40px rgba(40, 28, 16, .12);--radius: 18px;--mono: "Courier New", Courier, monospace;--sans: "Trebuchet MS", "Segoe UI", sans-serif;--serif: "Palatino Linotype", "Book Antiqua", Palatino, serif}*{box-sizing:border-box}body{margin:0;min-height:100vh;background:var(--bg);color:var(--ink);font-family:var(--sans)}#app{padding:24px 12px 20px;min-height:100vh}.page{max-width:1920px;width:100%;margin:0 auto;display:flex;flex-direction:column;gap:24px;min-height:calc(100vh - 52px);animation:fadeIn .6s ease-out}.header{display:flex;flex-wrap:wrap;align-items:flex-start;gap:20px 32px;justify-content:space-between}.header h1{font-family:var(--serif);font-size:2.4rem;margin:0 0 8px}.header p{margin:0;color:var(--muted)}.controls{display:flex;flex-wrap:wrap;gap:12px 16px;align-items:center;justify-content:flex-end}.control-group{display:flex;flex-direction:column;gap:6px;font-size:.85rem;color:var(--muted)}.control-group.buttons{flex-direction:row;gap:12px}button{border:1px solid var(--border);border-radius:12px;padding:12px 20px;font-family:var(--sans);font-weight:600;background:#fff;color:var(--ink);cursor:pointer;transition:transform .2s ease,box-shadow .2s ease;min-width:140px}button:hover{transform:translateY(-1px);box-shadow:0 8px 18px #00000014}button.primary{background:linear-gradient(135deg,var(--accent),var(--accent-dark));border-color:transparent;color:#fff}.grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:20px;flex:1;min-height:0}.panel{background:var(--panel);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:12px;min-height:0}.panel.drag-over{outline:2px dashed var(--accent);outline-offset:4px;box-shadow:0 0 0 3px #c0663f2e,var(--shadow)}.panel-header{display:flex;align-items:center;justify-content:space-between;gap:12px}.panel-header h2{margin:0;font-size:1.2rem}.badge{background:#c0663f1f;color:var(--accent-dark);padding:4px 10px;border-radius:999px;font-size:.75rem;font-weight:600}textarea{flex:1;width:100%;resize:vertical;min-height:0;border-radius:14px;border:1px solid var(--border);padding:14px;font-size:.9rem;font-family:var(--mono);background:#fff;color:var(--ink);line-height:1.5;white-space:pre;overflow-wrap:normal;overflow:auto}textarea[readonly]{background:#faf7f1}@keyframes fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@media (max-width: 720px){.header{flex-direction:column;align-items:flex-start}.controls{width:100%;justify-content:flex-start}.grid{grid-template-columns:1fr;flex:1}}

</style>
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
