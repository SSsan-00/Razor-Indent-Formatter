<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Razor Indent Formatter</title>
    <script type="module" crossorigin>
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();const X=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"]),j=new Set(["script","style"]),Y=/<\s*\/\s*text\s*>/i,P="<!--",q="-->";function Q(n,t){const i=tt(t.indentSize),{lines:e,lineEnding:s}=et(n),o=e.map(l=>nt(l,i)),r=new Array(e.length).fill(null),a=new Array(e.length).fill(!1),c=new Array(e.length).fill(0),d=new Array(e.length).fill(null),p=[],y=[];let C=0,v=!1,L=null,w=!1,f=null,x=!1,S=!1;for(let l=0;l<e.length;l+=1){const g=e[l],m=o[l],h=m.rest.trimStart(),I=Y.test(h),k=x&&_(g,(f==null?void 0:f.tagName)??"");if(w&&I&&(f&&(f.endLine=l-1,y.push(f),f=null),w=!1),x&&k&&(f&&(f.endLine=l-1,y.push(f),f=null),x=!1),w||x){r[l]=null;continue}const R=st(g,v);v=R.inComment;const T=R.cleaned;let B=rt(h),D=0,W=0;if(L)_(T,L)&&(W+=1,B===0&&h.startsWith(`</${L}`)&&(B=1),L=null);else if(!v){if(at(h)){const K=ot(T);for(const M of K){if(M.isClosing){W+=1;continue}M.isSelfClosing||(D+=1,j.has(M.name)&&(L=M.name))}}const A=H(m.rest,S);S=A.inBlockComment,D+=A.open,W+=A.close}const J=Math.max(0,C-B);r[l]=J*i,C=Math.max(0,C-W+D),N(h,"text")&&!z(h,"text")&&(w=!0,f={startLine:l+1,endLine:l,parentLevel:Math.max(0,C-1),tagName:"text",skip:!1}),N(h,"script")&&!z(h,"script")&&(x=!0,f={startLine:l+1,endLine:l,parentLevel:Math.max(0,C-1),tagName:"script",skip:!1}),N(h,"style")&&!z(h,"style")&&(x=!0,f={startLine:l+1,endLine:l,parentLevel:Math.max(0,C-1),tagName:"style",skip:!1})}w&&f&&(f.endLine=e.length-1,f.skip=!0,y.push(f)),lt(y,r,o,i,a,c,d);for(let l=0;l<r.length;l+=1)r[l]===null&&(r[l]=o[l].leadingWidth);const $=e.map((l,g)=>{var I;const m=r[g]??0;let h=o[g].rest;return(I=d[g])!=null&&I.isRawBlock&&!a[g]&&(h=ut(h)),a[g]?dt(h,m,c[g]??0):V(h,m)}),E=ft($,d),b=E.lines.join(s),O=pt(o,E.lines,E.insertedBlankLines);if(!O.ok)return{output:n,logs:[],error:O.message};p.push("Validation ok: non-leading content unchanged.");for(let l=0;l<o.length;l+=1){const g=o[l].leadingWidth,m=r[l]??g;g!==m&&p.push(`Line ${l+1}: ${g} -> ${m}`)}return p.length===0&&p.push("No indentation changes detected."),{output:b,logs:p}}function tt(n){return!Number.isFinite(n)||n<=0?2:Math.floor(n)}function et(n){const t=n.includes(`\r
`)?`\r
`:`
`;return{lines:n.split(/\r\n|\n/),lineEnding:t}}function nt(n,t){const i=n.match(/^(\s*)(.*)$/);if(!i)return{original:n,leading:"",rest:n,leadingWidth:0};const e=i[1],s=i[2];return{original:n,leading:e,rest:s,leadingWidth:it(e,t)}}function it(n,t){let i=0;for(const e of n)e==="	"?i+=t:i+=1;return i}function st(n,t){let i="",e=0;for(;e<n.length;){if(t){const o=n.indexOf(q,e);if(o===-1)return{cleaned:i,inComment:!0};e=o+q.length,t=!1;continue}const s=n.indexOf(P,e);if(s===-1){i+=n.slice(e);break}i+=n.slice(e,s),e=s+P.length,t=!0}return{cleaned:i,inComment:t}}function ot(n){const t=[],i=/<[^>]+>/g;let e;for(;(e=i.exec(n))!==null;){const s=e[0];if(s.startsWith("<!")||s.startsWith("<?")||s.startsWith("<%"))continue;const o=s.match(/^<\s*\/?\s*([a-zA-Z0-9:-]+)/);if(!o)continue;const r=o[1].toLowerCase(),a=/^<\s*\//.test(s),c=/\/>\s*$/.test(s)||X.has(r);t.push({name:r,isClosing:a,isSelfClosing:c})}return t}function _(n,t){return t?new RegExp(`<\\s*\\/\\s*${t}\\s*>`,"i").test(n):!1}function rt(n){let t=0,i=n;for(;;){const e=i.match(/^<\s*\/\s*[a-zA-Z0-9:-]+[^>]*>\s*/);if(e){t+=1,i=i.slice(e[0].length);continue}const s=i.match(/^@?\}\s*/);if(s){t+=1,i=i.slice(s[0].length);continue}break}return t}function at(n){const t=n.toLowerCase();return t.startsWith("<")?!0:t.startsWith("@:")?t.slice(2).trimStart().startsWith("<"):!1}function N(n,t){const i=n.toLowerCase();return i.startsWith(`<${t}`)?!0:i.startsWith("@:")?i.slice(2).trimStart().startsWith(`<${t}`):!1}function z(n,t){const i=n.toLowerCase();return i.startsWith(`</${t}`)?!0:i.startsWith("@:")?i.slice(2).trimStart().startsWith(`</${t}`):!1}function lt(n,t,i,e,s,o,r){for(const a of n){if(a.skip||a.endLine<a.startLine){ct(a,t,i);continue}const c=j.has(a.tagName),d=a.parentLevel*e+(c&&a.parentLevel===0?0:e),p=[];let y=0,C=!1,v=null,L=!1,w=null;for(let f=a.startLine;f<=a.endLine;f+=1){const x=i[f].rest;if(x.length===0){t[f]=0,w=null,c&&(r[f]={isRawBlock:!0,isCaseOrDefault:!1,isBreak:!1,isSwitchLine:!1});continue}const S=x.trimStart(),$=gt(S),E=Math.max(0,y-($>0?1:0)),b=S.startsWith("@"),O=S.startsWith("@:"),l=b?"":S,g=c&&!b&&/^switch\s*\(/.test(l),m=c&&!b&&(/^case\b/.test(l)||/^default\b/.test(l)),h=c&&!b&&/^break\b/.test(l),I=c&&!b&&l.startsWith("}"),k=c&&p.length>0&&y>=p[p.length-1];let R=d+E*e;k&&v!==null&&!m&&!I&&(R+=e),c&&O?(w===null&&(w=E),R=d+w*e,k&&v!==null&&!m&&!I&&(R+=e),s[f]=!0,o[f]=Math.max(0,(E-w)*e)):c&&(w=null),t[f]=R,c&&(r[f]={isRawBlock:!0,isCaseOrDefault:k&&m,isBreak:k&&h,isSwitchLine:k&&g});const T=H(x,C);C=T.inBlockComment;const B=Math.max(0,y+T.open-T.close);for(c&&g&&(T.open>0?(p.push(B),L=!1):L=!0),c&&L&&!b&&T.open>0&&l.startsWith("{")&&(p.push(B),L=!1),L&&S.length>0&&!l.startsWith("{")&&(L=!1),k&&m&&(v=y);p.length>0&&B<p[p.length-1];)p.pop();v!==null&&B<v&&(v=null),y=B}}}function ct(n,t,i){for(let e=n.startLine;e<=n.endLine;e+=1)t[e]=i[e].leadingWidth}function ut(n){const i=n.trimStart().match(/^switch\s*\((.*)\)\s*\{\s*$/);return i?"switch ("+i[1].trim()+") {":n}function ft(n,t){const i=[];let e=!1,s=!1,o=!1,r=!1;for(let a=0;a<n.length;a+=1){const c=t[a];if(!c||!c.isRawBlock){s=!1,o=!1,r=!1,i.push(n[a]);continue}s||(s=!0,o=!1,r=!1),c.isCaseOrDefault&&o&&!r&&(i.push(""),e=!0),i.push(n[a]);const d=n[a].trim().length===0;r=d,d||(o=c.isBreak)}return{lines:i,insertedBlankLines:e}}function dt(n,t,i){const e=n.match(/^@:([\s]*)(.*)$/);if(!e)return V(n,t);const s=e[2],o=t>0?" ".repeat(t):"";if(s.length===0)return`${o}@:`;const r=e[1].length>0?" ":"";return`${o}@:${r}${" ".repeat(i)}${s.trimStart()}`}function V(n,t){return t<=0?n:`${" ".repeat(t)}${n}`}function pt(n,t,i){const e=n.map(a=>a.original);if(!i&&e.length!==t.length)return{ok:!1,message:"Validation failed: line count changed."};const s=[];let o=0,r=0;for(;o<e.length&&r<t.length;){const a=t[r];if(i&&a.trim().length===0){(e[o]??"").trim().length===0&&(o+=1),r+=1;continue}const c=F(e[o]),d=F(a);c!==d&&s.push(String(o+1)),o+=1,r+=1}if(o<e.length)for(let a=o;a<e.length;a+=1)s.push(String(a+1));if(i){for(let a=r;a<t.length;a+=1)if(t[a].trim().length>0){s.push(String(e.length));break}}else if(r<t.length)return{ok:!1,message:"Validation failed: line count changed."};return s.length>0?{ok:!1,message:`Validation failed: non-indentation content changed on line(s) ${s.join(", ")}.`}:{ok:!0,message:""}}function F(n){let t=n.replace(/^\s*/,"");return t.startsWith("@:")&&(t=t.replace(/^@:\s*/,"@:")),t=ht(t),t}function ht(n){const t=n.match(/^switch\s*\((.*)\)\s*\{\s*$/);return t?"switch ("+t[1].trim()+") {":n}function gt(n){let t=n;const i=t.match(/^@:\s*/);i&&(t=t.slice(i[0].length));let e=0,s=0;for(;s<t.length;){if(t[s]==="}"){e+=1,s+=1;continue}break}return e}function H(n,t){let i=0,e=0,s=!1,o=!1,r=!1,a=!1;for(let c=0;c<n.length;c+=1){const d=n[c],p=n[c+1]??"";if(t){d==="*"&&p==="/"&&(t=!1,c+=1);continue}if(!s&&!o&&!r){if(d==="/"&&p==="*"){t=!0,c+=1;continue}if(d==="/"&&p==="/")break}if(a){a=!1;continue}if(d==="\\\\"&&(s||o||r)){a=!0;continue}if(!o&&!r&&d==="'"){s=!s;continue}if(!s&&!r&&d==='"'){o=!o;continue}if(!s&&!o&&d==="`"){r=!r;continue}s||o||r||(d==="{"?i+=1:d==="}"&&(e+=1))}return{open:i,close:e,inBlockComment:t}}const G=4,Z=document.querySelector("#app");if(!Z)throw new Error("App root not found.");Z.innerHTML=`
  <div class="page">
    <header class="header">
      <div>
        <h1>Razor Indent Formatter</h1>
      </div>
      <div class="controls">
        <div class="control-group buttons">
          <button id="formatBtn" type="button" class="primary">Format</button>
          <button id="copyBtn" type="button">Copy Output</button>
          <button id="clearBtn" type="button">Clear</button>
          <button id="loadBtn" type="button">Load File</button>
          <input id="fileInput" type="file" hidden accept=".cshtml,.razor,.html,.cs,.js,.ts,.txt" />
        </div>
      </div>
    </header>

    <main class="grid">
      <section class="panel" id="inputPanel">
        <div class="panel-header">
          <h2>Input</h2>
          <span class="badge">Paste / Drop file</span>
        </div>
        <textarea id="input" spellcheck="false" wrap="off" placeholder="Paste Razor / HTML / JS here..."></textarea>
      </section>
      <section class="panel">
        <div class="panel-header">
          <h2>Output</h2>
          <span class="badge">Read-only</span>
        </div>
        <textarea id="output" spellcheck="false" wrap="off" readonly></textarea>
      </section>
    </main>

  </div>
`;const u=mt();u.formatButton.addEventListener("click",()=>{Lt(u)});u.copyButton.addEventListener("click",async()=>{const n=u.output.value;if(n)try{await navigator.clipboard.writeText(n),u.copyButton.textContent="Copied!",window.setTimeout(()=>{u.copyButton.textContent="Copy Output"},1200)}catch{u.copyButton.textContent="Copy failed",window.setTimeout(()=>{u.copyButton.textContent="Copy Output"},1200)}});u.clearButton.addEventListener("click",()=>{u.input.value="",u.output.value="",u.copyButton.textContent="Copy Output",u.input.focus()});u.loadButton.addEventListener("click",()=>{u.fileInput.click()});u.fileInput.addEventListener("change",async()=>{var t;const n=(t=u.fileInput.files)==null?void 0:t[0];n&&(await U(n,u),u.fileInput.value="")});u.input.addEventListener("keydown",n=>{if(n.key!=="Tab")return;n.preventDefault();const t=u.input.selectionStart??0,i=u.input.selectionEnd??t,e=" ".repeat(G),s=u.input.value;u.input.value=s.slice(0,t)+e+s.slice(i);const o=t+e.length;u.input.selectionStart=o,u.input.selectionEnd=o});yt(u);wt(u.input,u.output);function mt(){const n=document.querySelector("#input"),t=document.querySelector("#output"),i=document.querySelector("#inputPanel"),e=document.querySelector("#formatBtn"),s=document.querySelector("#copyBtn"),o=document.querySelector("#clearBtn"),r=document.querySelector("#loadBtn"),a=document.querySelector("#fileInput");if(!n||!t||!i||!e||!s||!o||!r||!a)throw new Error("UI elements not found.");return{input:n,output:t,inputPanel:i,formatButton:e,copyButton:s,clearButton:o,loadButton:r,fileInput:a}}function Lt(n){const t=Q(n.input.value,{indentSize:G});if(t.error){n.output.value=t.output;return}n.output.value=t.output}function wt(n,t){let i=!1;const e=(s,o)=>{i||(i=!0,o.scrollTop=s.scrollTop,o.scrollLeft=s.scrollLeft,window.requestAnimationFrame(()=>{i=!1}))};n.addEventListener("scroll",()=>e(n,t),{passive:!0}),t.addEventListener("scroll",()=>e(t,n),{passive:!0})}function yt(n){const{inputPanel:t}=n,i=e=>{e?t.classList.add("drag-over"):t.classList.remove("drag-over")};t.addEventListener("dragenter",e=>{e.preventDefault(),i(!0)}),t.addEventListener("dragover",e=>{e.preventDefault(),i(!0)}),t.addEventListener("dragleave",e=>{const s=e.relatedTarget;(!s||!(s instanceof Node)||!t.contains(s))&&i(!1)}),t.addEventListener("drop",async e=>{var o,r;e.preventDefault(),i(!1);const s=(r=(o=e.dataTransfer)==null?void 0:o.files)==null?void 0:r[0];s&&await U(s,n)})}async function U(n,t){const i=await n.arrayBuffer(),e=new Uint8Array(i),s=vt(e),r=new TextDecoder(s).decode(e);t.input.value=r,t.output.value="",t.copyButton.textContent="Copy Output",t.input.focus()}function vt(n){const t=["utf-8","shift_jis","euc-jp"];let i={encoding:"utf-8",score:Number.NEGATIVE_INFINITY};for(const e of t){const s=xt(n,e),o=Ct(s.text,s.hadReplacement);o>i.score&&(i={encoding:e,score:o})}return i.encoding}function xt(n,t){let i="",e=!1;if(t==="utf-8")try{return i=new TextDecoder("utf-8",{fatal:!0}).decode(n),{text:i,hadReplacement:!1}}catch{}return i=new TextDecoder(t).decode(n),e=i.includes("ï¿½"),{text:i,hadReplacement:e}}function Ct(n,t){let i=0,e=0;for(let o=0;o<n.length;o+=1){const r=n.charCodeAt(o);if(r!==65533){if(r<32&&r!==9&&r!==10&&r!==13){e+=1;continue}(r>=12352&&r<=12447||r>=12448&&r<=12543||r>=19968&&r<=40959||r>=65381&&r<=65439)&&(i+=1)}}let s=i*2-e*2;return t&&(s-=5),s}

</script>
    <style>
:root{--bg: radial-gradient(circle at top left, #f5f1e8, #efe6d6 40%, #e7dfd0 100%);--panel: #f9f6ef;--ink: #1f1c17;--muted: #6f655a;--accent: #c0663f;--accent-dark: #8d4b32;--border: #d9cfbf;--shadow: 0 18px 40px rgba(40, 28, 16, .12);--radius: 18px;--mono: "Courier New", Courier, monospace;--sans: "Trebuchet MS", "Segoe UI", sans-serif;--serif: "Palatino Linotype", "Book Antiqua", Palatino, serif}*{box-sizing:border-box}body{margin:0;min-height:100vh;background:var(--bg);color:var(--ink);font-family:var(--sans)}#app{padding:24px 12px 20px;min-height:100vh}.page{max-width:1920px;width:100%;margin:0 auto;display:flex;flex-direction:column;gap:24px;min-height:calc(100vh - 52px);animation:fadeIn .6s ease-out}.header{display:flex;flex-wrap:wrap;align-items:flex-start;gap:20px 32px;justify-content:space-between}.header h1{font-family:var(--serif);font-size:2.4rem;margin:0 0 8px}.header p{margin:0;color:var(--muted)}.controls{display:flex;flex-wrap:wrap;gap:12px 16px;align-items:center;justify-content:flex-end}.control-group{display:flex;flex-direction:column;gap:6px;font-size:.85rem;color:var(--muted)}.control-group.buttons{flex-direction:row;gap:12px}button{border:1px solid var(--border);border-radius:12px;padding:12px 20px;font-family:var(--sans);font-weight:600;background:#fff;color:var(--ink);cursor:pointer;transition:transform .2s ease,box-shadow .2s ease;min-width:140px}button:hover{transform:translateY(-1px);box-shadow:0 8px 18px #00000014}button.primary{background:linear-gradient(135deg,var(--accent),var(--accent-dark));border-color:transparent;color:#fff}.grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:20px;flex:1;min-height:0}.panel{background:var(--panel);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:12px;min-height:0}.panel.drag-over{outline:2px dashed var(--accent);outline-offset:4px;box-shadow:0 0 0 3px #c0663f2e,var(--shadow)}.panel-header{display:flex;align-items:center;justify-content:space-between;gap:12px}.panel-header h2{margin:0;font-size:1.2rem}.badge{background:#c0663f1f;color:var(--accent-dark);padding:4px 10px;border-radius:999px;font-size:.75rem;font-weight:600}textarea{flex:1;width:100%;resize:vertical;min-height:0;border-radius:14px;border:1px solid var(--border);padding:14px;font-size:.9rem;font-family:var(--mono);background:#fff;color:var(--ink);line-height:1.5;white-space:pre;overflow-wrap:normal;overflow:auto}textarea[readonly]{background:#faf7f1}@keyframes fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@media (max-width: 720px){.header{flex-direction:column;align-items:flex-start}.controls{width:100%;justify-content:flex-start}.grid{grid-template-columns:1fr;flex:1}}

</style>
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
