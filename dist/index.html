<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Razor Indent Formatter</title>
    <script type="module" crossorigin>
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const K=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"]),F=new Set(["script","style"]),X=/<\s*\/\s*text\s*>/i,A="<!--",P="-->";function Y(e,t){const n=Q(t.indentSize),{lines:i,lineEnding:s}=tt(e),o=i.map(c=>et(c,n)),r=new Array(i.length).fill(null),a=new Array(i.length).fill(!1),d=new Array(i.length).fill(null),l=[],g=[];let v=0,b=!1,B=null,L=!1,f=null,w=!1,T=!1;for(let c=0;c<i.length;c+=1){const h=i[c],m=o[c],p=m.rest.trimStart(),k=X.test(p),W=w&&q(h,(f==null?void 0:f.tagName)??"");if(L&&k&&(f&&(f.endLine=c-1,g.push(f),f=null),L=!1),w&&W&&(f&&(f.endLine=c-1,g.push(f),f=null),w=!1),L||w){r[c]=null;continue}const O=it(h,b);b=O.inComment;const S=O.cleaned;let E=ot(p),y=0,C=0;if(B)q(S,B)&&(C+=1,E===0&&p.startsWith(`</${B}`)&&(E=1),B=null);else if(!b){if(rt(p)){const J=st(S);for(const D of J){if(D.isClosing){C+=1;continue}D.isSelfClosing||(y+=1,F.has(D.name)&&(B=D.name))}}const z=V(m.rest,T);T=z.inBlockComment,y+=z.open,C+=z.close}const U=Math.max(0,v-E);r[c]=U*n,v=Math.max(0,v-C+y),$(p,"text")&&!N(p,"text")&&(L=!0,f={startLine:c+1,endLine:c,parentLevel:Math.max(0,v-1),tagName:"text",skip:!1}),$(p,"script")&&!N(p,"script")&&(w=!0,f={startLine:c+1,endLine:c,parentLevel:Math.max(0,v-1),tagName:"script",skip:!1}),$(p,"style")&&!N(p,"style")&&(w=!0,f={startLine:c+1,endLine:c,parentLevel:Math.max(0,v-1),tagName:"style",skip:!1})}L&&f&&(f.endLine=i.length-1,f.skip=!0,g.push(f)),at(g,r,o,n,a,d);for(let c=0;c<r.length;c+=1)r[c]===null&&(r[c]=o[c].leadingWidth);const M=i.map((c,h)=>{var k;const m=r[h]??0;let p=o[h].rest;return(k=d[h])!=null&&k.isRawBlock&&!a[h]&&(p=lt(p)),a[h]?ft(p,m):j(p,m)}),R=ut(M,d),x=R.lines.join(s),I=dt(o,R.lines,R.insertedBlankLines);if(!I.ok)return{output:e,logs:[],error:I.message};l.push("Validation ok: non-leading content unchanged.");for(let c=0;c<o.length;c+=1){const h=o[c].leadingWidth,m=r[c]??h;h!==m&&l.push(`Line ${c+1}: ${h} -> ${m}`)}return l.length===0&&l.push("No indentation changes detected."),{output:x,logs:l}}function Q(e){return!Number.isFinite(e)||e<=0?2:Math.floor(e)}function tt(e){const t=e.includes(`\r
`)?`\r
`:`
`;return{lines:e.split(/\r\n|\n/),lineEnding:t}}function et(e,t){const n=e.match(/^(\s*)(.*)$/);if(!n)return{original:e,leading:"",rest:e,leadingWidth:0};const i=n[1],s=n[2];return{original:e,leading:i,rest:s,leadingWidth:nt(i,t)}}function nt(e,t){let n=0;for(const i of e)i==="	"?n+=t:n+=1;return n}function it(e,t){let n="",i=0;for(;i<e.length;){if(t){const o=e.indexOf(P,i);if(o===-1)return{cleaned:n,inComment:!0};i=o+P.length,t=!1;continue}const s=e.indexOf(A,i);if(s===-1){n+=e.slice(i);break}n+=e.slice(i,s),i=s+A.length,t=!0}return{cleaned:n,inComment:t}}function st(e){const t=[],n=/<[^>]+>/g;let i;for(;(i=n.exec(e))!==null;){const s=i[0];if(s.startsWith("<!")||s.startsWith("<?")||s.startsWith("<%"))continue;const o=s.match(/^<\s*\/?\s*([a-zA-Z0-9:-]+)/);if(!o)continue;const r=o[1].toLowerCase(),a=/^<\s*\//.test(s),d=/\/>\s*$/.test(s)||K.has(r);t.push({name:r,isClosing:a,isSelfClosing:d})}return t}function q(e,t){return t?new RegExp(`<\\s*\\/\\s*${t}\\s*>`,"i").test(e):!1}function ot(e){let t=0,n=e;for(;;){const i=n.match(/^<\s*\/\s*[a-zA-Z0-9:-]+[^>]*>\s*/);if(i){t+=1,n=n.slice(i[0].length);continue}const s=n.match(/^@?\}\s*/);if(s){t+=1,n=n.slice(s[0].length);continue}break}return t}function rt(e){const t=e.toLowerCase();return t.startsWith("<")?!0:t.startsWith("@:")?t.slice(2).trimStart().startsWith("<"):!1}function $(e,t){const n=e.toLowerCase();return n.startsWith(`<${t}`)?!0:n.startsWith("@:")?n.slice(2).trimStart().startsWith(`<${t}`):!1}function N(e,t){const n=e.toLowerCase();return n.startsWith(`</${t}`)?!0:n.startsWith("@:")?n.slice(2).trimStart().startsWith(`</${t}`):!1}function at(e,t,n,i,s,o){for(const r of e){if(r.skip||r.endLine<r.startLine){ct(r,t,n);continue}const a=F.has(r.tagName),d=r.parentLevel*i+(a&&r.parentLevel===0?0:i),l=[];let g=0,v=!1,b=0,B=!1,L=null;for(let f=r.startLine;f<=r.endLine;f+=1){const w=n[f].rest;if(w.length===0){t[f]=0,a&&(o[f]={isRawBlock:!0,isCaseOrDefault:!1,isBreak:!1,isSwitchLine:!1});continue}const T=w.trimStart(),M=ht(T),R=Math.max(0,g-(M>0?1:0)),x=T.startsWith("@"),I=T.startsWith("@:"),h=a&&(B||x&&!I),m=x?"":T,p=a&&!x&&/^switch\s*\(/.test(m),k=a&&!x&&(/^case\b/.test(m)||/^default\b/.test(m)),W=a&&!x&&/^break\b/.test(m),O=a&&!x&&m.startsWith("}"),S=a&&l.length>0&&g>=l[l.length-1];let E=d+R*i;a&&(x||h)&&(E=R*i),S&&L!==null&&!k&&!O&&(E+=i),t[f]=E,a&&I&&(s[f]=!0),a&&(o[f]={isRawBlock:!0,isCaseOrDefault:S&&k,isBreak:S&&W,isSwitchLine:S&&p});const y=V(w,v);v=y.inBlockComment;const C=Math.max(0,g+y.open-y.close);for(h&&(b=Math.max(0,b+y.open-y.close),B=b>0),a&&p&&y.open>0&&l.push(C),S&&k&&(L=g);l.length>0&&C<l[l.length-1];)l.pop();L!==null&&C<L&&(L=null),g=C}}}function ct(e,t,n){for(let i=e.startLine;i<=e.endLine;i+=1)t[i]=n[i].leadingWidth}function lt(e){const n=e.trimStart().match(/^switch\s*\((.*)\)\s*\{\s*$/);return n?"switch ("+n[1].trim()+") {":e}function ut(e,t){const n=[];let i=!1,s=!1,o=!1,r=!1;for(let a=0;a<e.length;a+=1){const d=t[a];if(!d||!d.isRawBlock){s=!1,o=!1,r=!1,n.push(e[a]);continue}s||(s=!0,o=!1,r=!1),d.isCaseOrDefault&&o&&!r&&(n.push(""),i=!0),n.push(e[a]);const l=e[a].trim().length===0;r=l,l||(o=d.isBreak)}return{lines:n,insertedBlankLines:i}}function ft(e,t){const n=e.match(/^@:([\s]*)(.*)$/);if(!n)return j(e,t);const i=n[2];return i.length===0?"@:":`@:${n[1].length>0?" ":""}${" ".repeat(t)}${i.trimStart()}`}function j(e,t){return t<=0?e:`${" ".repeat(t)}${e}`}function dt(e,t,n){const i=e.map(a=>a.original);if(!n&&i.length!==t.length)return{ok:!1,message:"Validation failed: line count changed."};const s=[];let o=0,r=0;for(;o<i.length&&r<t.length;){const a=t[r];if(n&&a.trim().length===0){r+=1;continue}const d=_(i[o]),l=_(a);d!==l&&s.push(String(o+1)),o+=1,r+=1}if(o<i.length)for(let a=o;a<i.length;a+=1)s.push(String(a+1));if(n){for(let a=r;a<t.length;a+=1)if(t[a].trim().length>0){s.push(String(i.length));break}}else if(r<t.length)return{ok:!1,message:"Validation failed: line count changed."};return s.length>0?{ok:!1,message:`Validation failed: non-indentation content changed on line(s) ${s.join(", ")}.`}:{ok:!0,message:""}}function _(e){let t=e.replace(/^\s*/,"");return t.startsWith("@:")&&(t=t.replace(/^@:\s*/,"@:")),t=pt(t),t}function pt(e){const t=e.match(/^switch\s*\((.*)\)\s*\{\s*$/);return t?"switch ("+t[1].trim()+") {":e}function ht(e){let t=e;const n=t.match(/^@:\s*/);n&&(t=t.slice(n[0].length));let i=0,s=0;for(;s<t.length;){if(t[s]==="}"){i+=1,s+=1;continue}break}return i}function V(e,t){let n=0,i=0,s=!1,o=!1,r=!1,a=!1;for(let d=0;d<e.length;d+=1){const l=e[d],g=e[d+1]??"";if(t){l==="*"&&g==="/"&&(t=!1,d+=1);continue}if(!s&&!o&&!r){if(l==="/"&&g==="*"){t=!0,d+=1;continue}if(l==="/"&&g==="/")break}if(a){a=!1;continue}if(l==="\\\\"&&(s||o||r)){a=!0;continue}if(!o&&!r&&l==="'"){s=!s;continue}if(!s&&!r&&l==='"'){o=!o;continue}if(!s&&!o&&l==="`"){r=!r;continue}s||o||r||(l==="{"?n+=1:l==="}"&&(i+=1))}return{open:n,close:i,inBlockComment:t}}const H=4,Z=document.querySelector("#app");if(!Z)throw new Error("App root not found.");Z.innerHTML=`
  <div class="page">
    <header class="header">
      <div>
        <h1>Razor Indent Formatter</h1>
      </div>
      <div class="controls">
        <div class="control-group buttons">
          <button id="formatBtn" type="button" class="primary">Format</button>
          <button id="copyBtn" type="button">Copy Output</button>
          <button id="clearBtn" type="button">Clear</button>
          <button id="loadBtn" type="button">Load File</button>
          <input id="fileInput" type="file" hidden accept=".cshtml,.razor,.html,.cs,.js,.ts,.txt" />
        </div>
      </div>
    </header>

    <main class="grid">
      <section class="panel" id="inputPanel">
        <div class="panel-header">
          <h2>Input</h2>
          <span class="badge">Paste / Drop file</span>
        </div>
        <textarea id="input" spellcheck="false" wrap="off" placeholder="Paste Razor / HTML / JS here..."></textarea>
      </section>
      <section class="panel">
        <div class="panel-header">
          <h2>Output</h2>
          <span class="badge">Read-only</span>
        </div>
        <textarea id="output" spellcheck="false" wrap="off" readonly></textarea>
      </section>
    </main>

  </div>
`;const u=gt();u.formatButton.addEventListener("click",()=>{mt(u)});u.copyButton.addEventListener("click",async()=>{const e=u.output.value;if(e)try{await navigator.clipboard.writeText(e),u.copyButton.textContent="Copied!",window.setTimeout(()=>{u.copyButton.textContent="Copy Output"},1200)}catch{u.copyButton.textContent="Copy failed",window.setTimeout(()=>{u.copyButton.textContent="Copy Output"},1200)}});u.clearButton.addEventListener("click",()=>{u.input.value="",u.output.value="",u.copyButton.textContent="Copy Output",u.input.focus()});u.loadButton.addEventListener("click",()=>{u.fileInput.click()});u.fileInput.addEventListener("change",async()=>{var t;const e=(t=u.fileInput.files)==null?void 0:t[0];e&&(await G(e,u),u.fileInput.value="")});u.input.addEventListener("keydown",e=>{if(e.key!=="Tab")return;e.preventDefault();const t=u.input.selectionStart??0,n=u.input.selectionEnd??t,i=" ".repeat(H),s=u.input.value;u.input.value=s.slice(0,t)+i+s.slice(n);const o=t+i.length;u.input.selectionStart=o,u.input.selectionEnd=o});wt(u);Lt(u.input,u.output);function gt(){const e=document.querySelector("#input"),t=document.querySelector("#output"),n=document.querySelector("#inputPanel"),i=document.querySelector("#formatBtn"),s=document.querySelector("#copyBtn"),o=document.querySelector("#clearBtn"),r=document.querySelector("#loadBtn"),a=document.querySelector("#fileInput");if(!e||!t||!n||!i||!s||!o||!r||!a)throw new Error("UI elements not found.");return{input:e,output:t,inputPanel:n,formatButton:i,copyButton:s,clearButton:o,loadButton:r,fileInput:a}}function mt(e){const t=Y(e.input.value,{indentSize:H});t.error||(e.output.value=t.output)}function Lt(e,t){let n=!1;const i=(s,o)=>{n||(n=!0,o.scrollTop=s.scrollTop,o.scrollLeft=s.scrollLeft,window.requestAnimationFrame(()=>{n=!1}))};e.addEventListener("scroll",()=>i(e,t),{passive:!0}),t.addEventListener("scroll",()=>i(t,e),{passive:!0})}function wt(e){const{inputPanel:t}=e,n=i=>{i?t.classList.add("drag-over"):t.classList.remove("drag-over")};t.addEventListener("dragenter",i=>{i.preventDefault(),n(!0)}),t.addEventListener("dragover",i=>{i.preventDefault(),n(!0)}),t.addEventListener("dragleave",i=>{const s=i.relatedTarget;(!s||!(s instanceof Node)||!t.contains(s))&&n(!1)}),t.addEventListener("drop",async i=>{var o,r;i.preventDefault(),n(!1);const s=(r=(o=i.dataTransfer)==null?void 0:o.files)==null?void 0:r[0];s&&await G(s,e)})}async function G(e,t){const n=await e.arrayBuffer(),i=new Uint8Array(n),s=yt(i),r=new TextDecoder(s).decode(i);t.input.value=r,t.output.value="",t.copyButton.textContent="Copy Output",t.input.focus()}function yt(e){const t=["utf-8","shift_jis","euc-jp"];let n={encoding:"utf-8",score:Number.NEGATIVE_INFINITY};for(const i of t){const s=vt(e,i),o=xt(s.text,s.hadReplacement);o>n.score&&(n={encoding:i,score:o})}return n.encoding}function vt(e,t){let n="",i=!1;if(t==="utf-8")try{return n=new TextDecoder("utf-8",{fatal:!0}).decode(e),{text:n,hadReplacement:!1}}catch{}return n=new TextDecoder(t).decode(e),i=n.includes("ï¿½"),{text:n,hadReplacement:i}}function xt(e,t){let n=0,i=0;for(let o=0;o<e.length;o+=1){const r=e.charCodeAt(o);if(r!==65533){if(r<32&&r!==9&&r!==10&&r!==13){i+=1;continue}(r>=12352&&r<=12447||r>=12448&&r<=12543||r>=19968&&r<=40959||r>=65381&&r<=65439)&&(n+=1)}}let s=n*2-i*2;return t&&(s-=5),s}

</script>
    <style>
:root{--bg: radial-gradient(circle at top left, #f5f1e8, #efe6d6 40%, #e7dfd0 100%);--panel: #f9f6ef;--ink: #1f1c17;--muted: #6f655a;--accent: #c0663f;--accent-dark: #8d4b32;--border: #d9cfbf;--shadow: 0 18px 40px rgba(40, 28, 16, .12);--radius: 18px;--mono: "Courier New", Courier, monospace;--sans: "Trebuchet MS", "Segoe UI", sans-serif;--serif: "Palatino Linotype", "Book Antiqua", Palatino, serif}*{box-sizing:border-box}body{margin:0;min-height:100vh;background:var(--bg);color:var(--ink);font-family:var(--sans)}#app{padding:24px 12px 20px;min-height:100vh}.page{max-width:1920px;width:100%;margin:0 auto;display:flex;flex-direction:column;gap:24px;min-height:calc(100vh - 52px);animation:fadeIn .6s ease-out}.header{display:flex;flex-wrap:wrap;align-items:flex-start;gap:20px 32px;justify-content:space-between}.header h1{font-family:var(--serif);font-size:2.4rem;margin:0 0 8px}.header p{margin:0;color:var(--muted)}.controls{display:flex;flex-wrap:wrap;gap:12px 16px;align-items:center;justify-content:flex-end}.control-group{display:flex;flex-direction:column;gap:6px;font-size:.85rem;color:var(--muted)}.control-group.buttons{flex-direction:row;gap:12px}button{border:1px solid var(--border);border-radius:12px;padding:12px 20px;font-family:var(--sans);font-weight:600;background:#fff;color:var(--ink);cursor:pointer;transition:transform .2s ease,box-shadow .2s ease;min-width:140px}button:hover{transform:translateY(-1px);box-shadow:0 8px 18px #00000014}button.primary{background:linear-gradient(135deg,var(--accent),var(--accent-dark));border-color:transparent;color:#fff}.grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:20px;flex:1;min-height:0}.panel{background:var(--panel);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:12px;min-height:0}.panel.drag-over{outline:2px dashed var(--accent);outline-offset:4px;box-shadow:0 0 0 3px #c0663f2e,var(--shadow)}.panel-header{display:flex;align-items:center;justify-content:space-between;gap:12px}.panel-header h2{margin:0;font-size:1.2rem}.badge{background:#c0663f1f;color:var(--accent-dark);padding:4px 10px;border-radius:999px;font-size:.75rem;font-weight:600}textarea{flex:1;width:100%;resize:vertical;min-height:0;border-radius:14px;border:1px solid var(--border);padding:14px;font-size:.9rem;font-family:var(--mono);background:#fff;color:var(--ink);line-height:1.5;white-space:pre;overflow-wrap:normal;overflow:auto}textarea[readonly]{background:#faf7f1}@keyframes fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@media (max-width: 720px){.header{flex-direction:column;align-items:flex-start}.controls{width:100%;justify-content:flex-start}.grid{grid-template-columns:1fr;flex:1}}

</style>
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
